//! # NetBit Backend Server
//! 
//! –≠—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä NetBit - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.
//! –°–µ—Ä–≤–µ—Ä –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:
//! - Git Smart HTTP Protocol –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏
//! - RESTful API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞–º–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ —á–∞—Ç–∞–º–∏
//! - WebSocket –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥–ª—è real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
//! - –°–∏—Å—Ç–µ–º—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
//!
//! ## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
//! 
//! ```
//! src/
//! ‚îú‚îÄ‚îÄ main.rs           # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞
//! ‚îú‚îÄ‚îÄ core/             # –Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã
//! ‚îÇ   ‚îú‚îÄ‚îÄ config.rs     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è  
//! ‚îÇ   ‚îú‚îÄ‚îÄ database.rs   # –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö SQLite
//! ‚îÇ   ‚îú‚îÄ‚îÄ auth.rs       # –°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ JWT
//! ‚îÇ   ‚îî‚îÄ‚îÄ types.rs      # –û–±—â–∏–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
//! ‚îú‚îÄ‚îÄ domain/           # –î–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
//! ‚îÇ   ‚îú‚îÄ‚îÄ user.rs       # –ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
//! ‚îÇ   ‚îú‚îÄ‚îÄ project.rs    # –ú–æ–¥–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞
//! ‚îÇ   ‚îú‚îÄ‚îÄ repository.rs # –ú–æ–¥–µ–ª—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
//! ‚îÇ   ‚îú‚îÄ‚îÄ chat.rs       # –ú–æ–¥–µ–ª—å —á–∞—Ç–∞
//! ‚îÇ   ‚îî‚îÄ‚îÄ notification.rs # –ú–æ–¥–µ–ª—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
//! ‚îú‚îÄ‚îÄ api/              # HTTP API –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
//! ‚îÇ   ‚îú‚îÄ‚îÄ user.rs       # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
//! ‚îÇ   ‚îú‚îÄ‚îÄ project.rs    # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø—Ä–æ–µ–∫—Ç–æ–≤
//! ‚îÇ   ‚îú‚îÄ‚îÄ git.rs        # Git Smart HTTP Protocol
//! ‚îÇ   ‚îú‚îÄ‚îÄ chat.rs       # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —á–∞—Ç–æ–≤
//! ‚îÇ   ‚îî‚îÄ‚îÄ notification.rs # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
//! ‚îî‚îÄ‚îÄ utils/            # –£—Ç–∏–ª–∏—Ç—ã –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
//!     ‚îú‚îÄ‚îÄ git.rs        # Git –æ–ø–µ—Ä–∞—Ü–∏–∏
//!     ‚îî‚îÄ‚îÄ helpers.rs    # –û–±—â–∏–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
//! ```

use actix_web::{web, App, HttpServer, middleware::Logger};
use actix_files as fs;
use actix_cors::Cors;
use env_logger;

// ============================================================================
// –ò–ú–ü–û–†–¢–´ –ú–û–î–£–õ–ï–ô –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
// ============================================================================

/// –Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã - –±–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
mod core;
/// –î–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
mod domain;
/// API –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ - HTTP —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
mod api;
/// –£—Ç–∏–ª–∏—Ç—ã - –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
mod utils;

/// üìö –ö–û–ú–ü–õ–ï–ö–°–ù–ê–Ø –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø
/// 
/// –≠—Ç–æ—Ç –º–æ–¥—É–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã
/// —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, –ª—É—á—à–∏–º–∏ –ø—Ä–∞–∫—Ç–∏–∫–∞–º–∏ –∏ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞–º–∏.
/// 
/// **–ù–ê–ß–ù–ò–¢–ï –ò–ó–£–ß–ï–ù–ò–ï –ö–û–î–ê –û–¢–°–Æ–î–ê!**
pub mod lib_doc;

use core::{database::Database, config::load_config, config::validate_config, config::print_config};

// ============================================================================
// –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
// ============================================================================

/// –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è NetBit Backend
/// 
/// –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
/// 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
/// 2. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
/// 3. –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö SQLite
/// 4. –í—ã–ø–æ–ª–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
/// 5. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç HTTP —Å–µ—Ä–≤–µ—Ä —Å CORS –∏ –º–∞—Ä—à—Ä—É—Ç–∞–º–∏
///
/// # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
/// - `HOST` - IP –∞–¥—Ä–µ—Å –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 0.0.0.0)
/// - `PORT` - –ü–æ—Ä—Ç –¥–ª—è HTTP —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 8000)  
/// - `DATABASE_URL` - –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö SQLite (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: gitea.db)
/// - `JWT_SECRET` - –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è JWT —Ç–æ–∫–µ–Ω–æ–≤
/// - `REPOSITORIES_PATH` - –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏
///
/// # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç
/// `std::io::Result<()>` - –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞
#[actix_web::main]
async fn main() -> std::io::Result<()> {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
    env_logger::init();
    println!("üöÄ Starting NetBit Backend Server...");

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    let config = load_config();
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
    if let Err(e) = validate_config(&config) {
        eprintln!("‚ùå Configuration error: {}", e);
        std::process::exit(1);
    }

    // –í—ã–≤–æ–¥ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–±–µ–∑ —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
    print_config(&config);

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö SQLite
    let database = match Database::new(&config.database_url) {
        Ok(db) => {
            println!("‚úÖ Database connected successfully");
            db
        },
        Err(e) => {
            eprintln!("‚ùå Failed to connect to database: {}", e);
            std::process::exit(1);
        }
    };

    // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    if let Err(e) = database.test_connection() {
        eprintln!("‚ùå Database connection test failed: {}", e);
        std::process::exit(1);
    }

    // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º—ã
    if let Err(e) = database.migrate() {
        eprintln!("‚ùå Database migration failed: {}", e);
        std::process::exit(1);
    }

    let bind_address = format!("{}:{}", config.host, config.port);
    println!("üåê Starting server at http://{}", bind_address);

    // –ó–∞–ø—É—Å–∫ HTTP —Å–µ—Ä–≤–µ—Ä–∞ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π middleware –∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤
    HttpServer::new(move || {
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CORS –¥–ª—è –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –≤–µ–± –∏ –º–æ–±–∏–ª—å–Ω—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏
        let cors = Cors::default()
            .allow_any_origin()      // –†–∞–∑—Ä–µ—à–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Å –ª—é–±—ã—Ö –¥–æ–º–µ–Ω–æ–≤ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏!)
            .allow_any_method()      // –†–∞–∑—Ä–µ—à–∏—Ç—å –≤—Å–µ HTTP –º–µ—Ç–æ–¥—ã (GET, POST, PUT, DELETE)
            .allow_any_header()      // –†–∞–∑—Ä–µ—à–∏—Ç—å –≤—Å–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
            .max_age(3600);          // –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ preflight –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ 1 —á–∞—Å

        App::new()
            // –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö
            .app_data(web::Data::new(database.clone()))
            // Middleware –¥–ª—è CORS
            .wrap(cors)
            // Middleware –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
            .wrap(Logger::default())
            // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤—Å–µ—Ö API –º–∞—Ä—à—Ä—É—Ç–æ–≤
            .configure(configure_routes)
    })
    .bind(&bind_address)?
    .run()
    .await
}

// ============================================================================
// –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø API –ú–ê–†–®–†–£–¢–û–í
// ============================================================================

/// –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –≤—Å–µ API –º–∞—Ä—à—Ä—É—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
/// 
/// –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤:
/// - `/api/auth/*` - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
/// - `/api/user/*` - –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏  
/// - `/api/projects/*` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏
/// - `/api/chats/*` - –°–∏—Å—Ç–µ–º–∞ —á–∞—Ç–æ–≤ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
/// - `/api/notifications/*` - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
/// - `/git/*` - Git Smart HTTP Protocol
/// - `/api/repos/*` - –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
///
/// # –ê—Ä–≥—É–º–µ–Ω—Ç—ã
/// * `cfg` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ç–æ—Ä —Å–µ—Ä–≤–∏—Å–æ–≤ Actix Web
fn configure_routes(cfg: &mut web::ServiceConfig) {
    cfg
        // ========================================================================
        // –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø –ò –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø
        // ========================================================================
        .service(
            web::scope("/api/auth")
                .route("/login", web::post().to(api::user::login))           // POST /api/auth/login
                .route("/register", web::post().to(api::user::register))     // POST /api/auth/register
        )
        
        // ========================================================================
        // –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø–ú–ò
        // ========================================================================
        .service(
            web::scope("/api/user")
                .route("/profile", web::get().to(api::user::user_profile))  // GET /api/user/profile
        )
        
        // ========================================================================
        // –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–†–û–ï–ö–¢–ê–ú–ò
        // ========================================================================
        .service(
            web::scope("/api/projects")
                .route("", web::get().to(api::project::list_projects))                              // GET /api/projects
                .route("/public", web::get().to(api::project::list_public_projects))               // GET /api/projects/public
                .route("/create", web::post().to(api::project::create_project))                     // POST /api/projects/create
                .route("/{user}/{project}", web::get().to(api::project::get_project))              // GET /api/projects/{user}/{project}
                .route("/{user}/{project}/config", web::get().to(api::project::get_project_config)) // GET /api/projects/{user}/{project}/config
                .route("/{user}/{project}/config", web::put().to(api::project::update_project_config)) // PUT /api/projects/{user}/{project}/config
                .route("/{user}/{project}/repos/create", web::post().to(api::project::create_repo_in_project)) // POST /api/projects/{user}/{project}/repos/create
        )
        
        // ========================================================================
        // –°–ò–°–¢–ï–ú–ê –£–í–ï–î–û–ú–õ–ï–ù–ò–ô
        // ========================================================================
        .service(
            web::scope("/api/notifications")
                .route("", web::get().to(api::notification::get_notifications))        // GET /api/notifications
                .route("", web::post().to(api::notification::create_notification))     // POST /api/notifications
                .route("/{id}", web::put().to(api::notification::update_notification)) // PUT /api/notifications/{id}
                .route("/{id}", web::delete().to(api::notification::delete_notification)) // DELETE /api/notifications/{id}
        )
        
        // ========================================================================
        // –°–ò–°–¢–ï–ú–ê –ß–ê–¢–û–í –ò –°–û–û–ë–©–ï–ù–ò–ô
        // ========================================================================
        .service(
            web::scope("/api/chats")
                .route("", web::get().to(api::chat::get_chats))                      // GET /api/chats - —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                .route("", web::post().to(api::chat::create_chat))                   // POST /api/chats - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞
                .route("/{id}", web::get().to(api::chat::get_chat))                  // GET /api/chats/{id} - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∞—Ç–µ
                .route("/{id}/messages", web::get().to(api::chat::get_messages))     // GET /api/chats/{id}/messages - —Å–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞
                .route("/{id}/messages", web::post().to(api::chat::send_message))    // POST /api/chats/{id}/messages - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        )
        
        // ========================================================================
        // –£–°–¢–ê–†–ï–í–®–ò–ï API –†–ï–ü–û–ó–ò–¢–û–†–ò–ï–í (TODO: –£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ –ø—Ä–æ–µ–∫—Ç—ã)
        // ========================================================================
        .service(
            web::scope("/api/repos")
                .route("", web::get().to(api::repo::list_repos))               // GET /api/repos
                .route("/create", web::post().to(api::repo::create_repo))       // POST /api/repos/create
                .route("/{repo_name}", web::get().to(api::repo::get_repo))      // GET /api/repos/{repo_name}
        )
        
        // ========================================================================
        // GIT SMART HTTP PROTOCOL - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Git –æ–ø–µ—Ä–∞—Ü–∏–π
        // ========================================================================
        .service(
            web::scope("/git")
                // Git info/refs - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–µ—Ç–∫–∞—Ö –∏ —Ç–µ–≥–∞—Ö
                .route("/{user_name}/{repo_name}/info/refs", 
                       web::get().to(api::git::handle_info_refs))
                // Git upload-pack - –æ–±—Ä–∞–±–æ—Ç–∫–∞ git fetch/pull
                .route("/{user_name}/{repo_name}/git-upload-pack", 
                       web::post().to(api::git::handle_upload_pack))
                // Git receive-pack - –æ–±—Ä–∞–±–æ—Ç–∫–∞ git push
                .route("/{user_name}/{repo_name}/git-receive-pack", 
                       web::post().to(api::git::handle_receive_pack))
        );
        
        // ========================================================================
        // –°–¢–ê–¢–ò–ß–ï–°–ö–ò–ï –§–ê–ô–õ–´ (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        // ========================================================================
        // –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
        // .service(fs::Files::new("/static", "./static").show_files_listing());
}